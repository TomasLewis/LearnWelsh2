function secondTimer(){totalTime++,minutes=Math.floor(totalTime/60)%60,seconds=Math.floor(totalTime)%60,seconds<10&&(seconds="0"+seconds),minutes<10&&(minutes="0"+minutes),$("#sign_brown_time").text(minutes+":"+seconds),gameMode&&(nextBirdTime++,nextBirdTime>=nextBird&&createBird())}function tbMove(e){i=e.x-game.player.body.x,j=e.y-game.player.body.y,k=Math.atan(j/i),i<0?(left=!0,right=!1):(right=!0,left=!1),j<0?(up=!0,down=!1):(down=!0,up=!1)}function tbStop(){left=!1,right=!1,up=!1,down=!1}function createBird(){plbi=!1,xLoc=Math.floor(Math.random()*GAME_WIDTH),birdA=Math.floor(xLoc<GAME_WIDTH/2?45*Math.random()+135:45*Math.random()+180),game.bird.body.x=xLoc,game.bird.body.y=-100,game.bird.body.angle=birdA,game.bird.revive(),game.bird.body.moveForward(bSpeed),game.bird.body.x>GAME_WIDTH&&removeBird(),game.bird.body.y>GAME_HEIGHT&&removeBird(),nextBirdTime=0}function removeBird(){game.bird.kill(),plbi=!1,nextBirdTime=0}function birdPlayerCollide(){plbi||(gameMode=!1,upScore(birdKillScore),removeBird(),removeFly(),game.player.kill(),g=window.setInterval(clearRightWrong,3e3),game.explosion.x=game.player.body.x-128,game.explosion.y=game.player.body.y-96,game.explosion.revive(),game.explosion.animations.play("explode"),game.explodeSnd.play(),game.player.body.x=GAME_WIDTH/2,game.player.body.y=GAME_HEIGHT-40,plbi=!0)}function flyPlayerCollide(){plfl||(game.frogH.revive(),game.eatFly.play(),game.frogH.animations.play("chomp"),removeFly(),removeBird(),game.player.kill())}function askQuestion(){gameMode=!1,initQuestion(),game.player.body.x=GAME_WIDTH/2,game.player.body.y=GAME_HEIGHT-40,plfl=!0}function createFly(){game.fly.body.x=250,game.fly.body.y=0,game.fly.revive(),game.buzz.loopFull(.6),plfl=!1}function flyFly(){flyA=game.fly.body.angle,mCount+=1,mCount>=20&&(mCount=0,flyA=Math.floor(361*Math.random())),game.fly.body.angle=flyA,game.fly.body.moveBackward(fSpeed),game.fly.body.x<flyWidthHalf&&(game.fly.body.x=flyWidthHalf),game.fly.body.y<flyWidthHalf&&(game.fly.body.y=flyWidthHalf),game.fly.body.x>GAME_WIDTH-flyWidthHalf&&(game.fly.body.x=GAME_WIDTH-flyWidthHalf),game.fly.body.y>GAME_HEIGHT-flyWidthHalf&&(game.fly.body.y=GAME_HEIGHT-flyWidthHalf)}function removeFly(){game.buzz.stop(),game.fly.kill()}function showBranch(){var e;for(e="primary"==level?[7,6,5,4,3,2,1]:[14,12,10,8,6,4,2],i=0;i<e.length;i++)numQuestions<=e[i]&&0==game.branches.getAt(i).alive&&game.branches.getAt(i).revive()}function startGame(){$.get(scorePHPpath+"frogFly_checkScore.php",{teachLevel:level,topic:displaytopic,language:ilanguage},function(e){"Y"==e.charAt(0)?(i=e.substring(1),j=i.indexOf("547625874"),curHighPlayer=i.substring(0,j),i=i.substring(j+9),j=i.indexOf("842069741"),curHighDate=i.substring(0,j),k=i.substring(j+9),curHighScore=parseInt(k),j=modStrings[8],j=j.replace("zzz","<br />"),j=j.replace("xxx",displaytopic),j=j.replace("yyy",ilanguage),i='<div style="margin:50px 0">'+j+"<br /><br /><br />",i+=modStrings[9]+" "+curHighPlayer+"<br />",i+=modStrings[10]+" "+curHighDate+"<br />",i+=modStrings[11]+" "+curHighScore+"</div>",$("#cHSBox").html(i),i=star(35,"gold","yellow"),$("#cHSBtn").html(i).css("display","block").on("click",function(){"none"==$("#cHSBox").css("display")?(pauseGame(!0),disablePauseButton(!0),$("#cHSBox").css("display","block")):($("#cHSBox").css("display","none"),pauseGame(!1),disablePauseButton(!1))})):$("#cHSBtn").css("display","none")}),0==isTablet?(i='<div id="fsBtn"><img src="'+resourceurl+'visuals/assets/gameAssets/frogFly/fullScG.png" width="41" height="41"></div>',/*$("#Div3DBannerFX").append(i),*/$("#fsBtn").on("click",function(){gofull()}),defaultStatusString=modStrings[4]):defaultStatusString=modStrings[5],$("#back").css("visibility","visible"),$("#statusBar").text(defaultStatusString),"primary"==level?(myArray=[0,1,2,3,4,5,6,7,8,9],nQS=numQuestions=8):(myArray=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],nQS=numQuestions=15,rightAnswerScore=25,wrongAnswerScore=-10,catchFlyScore=5,birdKillScore=-5),shuffle(myArray),game.state.start("level0"),$("#qPic1,#qPic2,#qPic3").on("click touchstart",function(){i=this.id,-1!=qArray[0].indexOf(i)?(upScore(rightAnswerScore),correct=1):(upScore(wrongAnswerScore),correct=-1),questionAnswered=1,clearQuestion()}),$(document).keydown(function(e){0==questionAnswered&&(i=e.which,(49==i||50==i||51==i)&&(e.preventDefault(),i=49==i?1:50==i?2:3,j=parseInt(qArray[0].charAt(5)),j==i?(upScore(rightAnswerScore),correct=1):(upScore(wrongAnswerScore),correct=-1),questionAnswered=1,clearQuestion()))})}function initQuestion(){disablePauseButton(!0),game.bgSnd.pause(),questionAnswered=0,$("#statusBar").text(modStrings[6]),upScore(catchFlyScore),answer=myArray[count],wrong1=myArray[count+1],wrong2=myArray[count+2],count+=1,numQuestions-=1,$("#qText").text(labelsarray[answer]),shuffle(qArray),$(qArray[0]).html('<img id="a" src="'+smallPicsURL+picsarray[answer]+'.png" width="115px" height="115px" />'),$(qArray[1]).html('<img id="w1" src="'+smallPicsURL+picsarray[wrong1]+'.png" width="115px" height="115px" />'),$(qArray[2]).html('<img id="w2" src="'+smallPicsURL+picsarray[wrong2]+'.png" width="115px" height="115px" />'),$("#qBox").css("display","block"),qTime=5,whistle=new Howl({urls:[soundURL+"games/bombWhistle.mp3"],autoplay:!0}),$("#qTime").text(qTime),g=window.setInterval(cntDwn,1e3)}function cntDwn(){qTime-=1,-1==qTime&&(correct=0,clearQuestion()),$("#qTime").text(qTime)}function clearQuestion(){window.clearInterval(g),whistle.stop(),i=1==correct?2e3:4e3,g=window.setInterval(clearRightWrong,i),$("#qBox").css("display","none"),0==correct||-1==correct?(game.explosion.x=170,game.explosion.y=122,game.explosion.revive(),game.explosion.animations.play("explode"),game.explodeSnd.play()):(game.firework.revive(),game.firework.animations.play("fire"),game.correctSnd.play())}function clearRightWrong(){window.clearInterval(g),game.firework.animations.stop("fire",0),game.explosion.animations.stop("explode",0),game.firework.kill(),game.explosion.kill(),$("#count").text(count+1<=nQS?count+1+" / "+nQS:nQS+" / "+nQS),0==numQuestions?endGame():(gameMode=!0,correct=0,$("#statusBar").text(defaultStatusString),disablePauseButton(!1),game.bgSnd.resume(),game.player.revive(),setTimeout(function(){createFly()},1e3))}function endGame(){disablePauseButton(!0),game.destroy(),defaultStatusString=modStrings[7],$("#statusBar").text(defaultStatusString),i=total-totalTime,j="Checking your score...",i<0&&(0==i,j=""),i='<div id="finalScore">For: '+displaytopic+" in "+ilanguage+"<br />Points: "+total+"<br />Time: "+totalTime+" seconds<br />Score: "+i+"<br />(total points - time taken)</div>",$("#sign").html(i),$("#finalScore").css("display","block"),total-=totalTime,""==j?($("#gameOver").fadeIn(2e3),animate(),playWinAudio()):""==curHighPlayer||total>curHighScore?(i='<div id="highScore">You got the Highest Score so far:',i+='<form name="save" method="POST" action=""><div><label for="name">'+modStrings[9]+'</label><input type="text" name="name" id="name" maxlength="35" value="anonymous" /></div><div class="button"><button name="SaveScore" id="savescore" type="submit">Save high score</button></div></form></div>',$("#sign").append(i),$("#highScore").css("display","block"),$("#savescore").on("click",function(e){e.preventDefault();var a=$("#name").val();$.post(scorePHPpath+"frogFly_setScore.php",{teachLevel:level,topic:displaytopic,score:total,playerName:a,language:ilanguage},function(){$("#gameOver").fadeIn(2e3),animate(),playWinAudio(),$("#highScore").css("display","none")})})):($("#gameOver").fadeIn(2e3),animate())}function gofull(){game.scale.isFullScreen?game.scale.stopFullScreen():game.scale.startFullScreen(!1)}function upScore(e){total+=e,0>total&&(total=0),$("#sign_brown_count").text(total),showBranch()}function pauseGame(e){1==e?(game.paused=!0,$("#pause").html('<div id="arrow-right"></div>')):(game.paused=!1,$("#pause").html('<div id="pause1"></div><div id="pause2"></div>'))}function disablePauseButton(e){1==e?(i="#666",j="#ccc",pauseDisabled=!0):(i="#000",j="yellow",pauseDisabled=!1),$("#pause1, #pause2").css("background",i),$("#pause").css({background:j,"border-color":i}),$("#arrow-right").css("border-left-color",i)}function resizePolygon(e,a,o,i){for(var r=[],t=this.game.cache.getPhysicsData(e,o),s=0;s<t.length;s++){for(var l=[],n=0;n<t[s].shape.length;n+=2)l[n]=t[s].shape[n]*i,l[n+1]=t[s].shape[n+1]*i;r.push({shape:l})}var d={};d[o]=r,game.load.physics(a,"",d)}function setupPhysics(){game.physics.startSystem(Phaser.Physics.P2JS),game.physics.p2.setImpactEvents(!0),game.physics.defaultRestitution=.4,game.physics.p2.gravity.y=800,game.physics.p2.friction=4,game.world.enableBodySleeping=!0,game.stage.smoothed=!1,groundMaterial=game.physics.p2.createMaterial("ground"),playerMaterial=game.physics.p2.createMaterial("player"),game.physics.p2.createContactMaterial(playerMaterial,groundMaterial,{friction:16,restitution:.6}),playerCG=game.physics.p2.createCollisionGroup(),flyCG=game.physics.p2.createCollisionGroup(),groundCG=game.physics.p2.createCollisionGroup(),birdCG=game.physics.p2.createCollisionGroup(),game.physics.p2.updateBoundsCollisionGroup()}var game,fly,bird,player,cursors,GAME_WIDTH=596,GAME_HEIGHT=436,totalTime,total=0,numQuestions,correct=0,nQS;count=0;var gameMode=!0,answer,wrong1,wrong2,qTime,g,qArray=["#qPic1","#qPic2","#qPic3"],questionAnswered=1,explosion,firework,left=!1,right=!1,up=!1,down=!1,winMusic=1,whistle,playerCG,groundCG,flyCG,birdCG,mCount=0,flyA,birdA;i=isTablet?100:200;var bSpeed=300,fSpeed=Math.floor(Math.random()*i+i),flyWidthHalf=22,nextBirdTime=0,nextBird=5,plfl=!1,plbi=!1,frogH,frogH_anim,rightAnswerScore=50,wrongAnswerScore=-20,catchFlyScore=10,birdKillScore=-10,scorePHPpath="http://static-iclanguage.net/jScript/cors/",curHighPlayer="",curHighDate="",curHighScore=0,pauseDisabled=!1,BootState={preload:function(){},create:function(){game.state.start("preload")}},PreloadState={preload:function(){game.load.crossOrigin="Anonymous",game.load.image("bg",resourceurl+"visuals/assets/gameAssets/frogFly/sky.png"),game.load.image("ground",resourceurl+"visuals/assets/gameAssets/frogFly/branch.png"),game.load.physics("branchPh",resourceurl+"visuals/assets/gameAssets/frogFly/branch.json"),game.load.physics("birdPh",resourceurl+"visuals/assets/gameAssets/frogFly/bird.json"),game.load.image("fly",resourceurl+"visuals/assets/gameAssets/frogFly/fly.png"),game.load.image("bird",resourceurl+"visuals/assets/gameAssets/frogFly/bird.png"),game.load.spritesheet("explosion",resourceurl+"visuals/assets/gameAssets/frogFly/explosion-6x5.png",256,192,28),game.load.spritesheet("firework",resourceurl+"visuals/assets/gameAssets/frogFly/firework-5x4.png",300,294,20),game.load.spritesheet("dude",resourceurl+"visuals/assets/gameAssets/frogFly/frog.png",32,42),game.load.spritesheet("frogHead",resourceurl+"visuals/assets/gameAssets/frogFly/frogHeadBig.png",148,125),game.load.audio("whistle",soundURL+"games/bombWhistle.mp3"),game.load.audio("bombBang",soundURL+"games/bombBang.mp3"),game.load.audio("buzz",soundURL+"games/fly.mp3"),game.load.audio("bgSnd",soundURL+"games/frog-chorus.mp3"),game.load.audio("correctSnd",soundURL+"games/ping.mp3"),game.load.audio("eatFly",soundURL+"games/eatFly.mp3")}},Level0={preload:function(){},create:function(){var e,a;totalTime=0,game.add.sprite(0,0,"bg"),game.bgSnd=game.add.audio("bgSnd"),game.bgSnd.loopFull(.5),game.explodeSnd=game.add.audio("bombBang"),game.correctSnd=game.add.audio("correctSnd"),game.eatFly=game.add.audio("eatFly"),game.explosion=game.add.sprite(170,122,"explosion"),game.explosion.animations.add("explode",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],11,!1),game.explosion.kill(),game.firework=game.add.sprite(148,70,"firework"),game.firework.animations.add("fire",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],9,!1),game.firework.kill(),setupPhysics(),resizePolygon("branchPh","branchPh2","branch",-1),e=game.add.sprite(130,GAME_HEIGHT,"ground"),game.physics.p2.enable(e),e.body["static"]=!0,e.body.setMaterial(groundMaterial),e.body.clearShapes(),e.body.loadPolygon("branchPh","branch"),e.body.setCollisionGroup(groundCG),e.body.collides([playerCG,flyCG]),a=game.add.sprite(GAME_WIDTH-120,GAME_HEIGHT,"ground"),a.scale.set(-1),game.physics.p2.enable(a),a.body["static"]=!0,a.body.setMaterial(groundMaterial),a.body.clearShapes(),a.body.loadPolygon("branchPh2","branch"),a.body.setCollisionGroup(groundCG),a.body.collides([playerCG,flyCG]),game.branches=game.add.group(),this.addBranch(180,GAME_HEIGHT/4.01,1),game.branches.getAt(0).kill(),this.addBranch(GAME_WIDTH-120,GAME_HEIGHT/2.65,-1),game.branches.getAt(1).kill(),this.addBranch(128,GAME_HEIGHT/1.62,1),game.branches.getAt(2).kill(),this.addBranch(GAME_WIDTH-74,GAME_HEIGHT/1.58,-1),game.branches.getAt(3).kill(),this.addBranch(-86,GAME_HEIGHT/2.06,1),game.branches.getAt(4).kill(),this.addBranch(GAME_WIDTH-100,-8,-1),game.branches.getAt(5).kill(),this.addBranch(130,-8,1),game.branches.getAt(6).kill(),game.player=game.add.sprite(GAME_WIDTH/2,GAME_HEIGHT-40,"dude"),game.physics.p2.enable(game.player),game.player.animations.add("left",[0,1,2,3],10,!0),game.player.animations.add("right",[5,6,7,8],10,!0),game.player.animations.add("up",[9,10,11],5,!0),game.player.body.fixedRotation=!0,game.player.body.collideWorldBounds=!0,game.player.body.setCollisionGroup(playerCG),game.player.body.collides(groundCG),game.player.body.collides(flyCG,flyPlayerCollide,game),game.player.body.collides(birdCG,birdPlayerCollide,game),game.buzz=game.add.audio("buzz"),game.fly=game.add.sprite(0,0,"fly"),game.physics.p2.enable(game.fly),game.fly.body.motionState=p2.Body.KINEMATIC,game.fly.body.setCollisionGroup(flyCG),game.fly.body.collides(playerCG,flyPlayerCollide,game),game.fly.body.collides(birdCG),game.fly.kill(),createFly(),game.bird=game.add.sprite(-200,-200,"bird"),game.physics.p2.enable(game.bird),game.bird.body.motionState=p2.Body.KINEMATIC,game.bird.body.clearShapes(),game.bird.body.loadPolygon("birdPh","bird"),game.bird.body.setCollisionGroup(birdCG),game.bird.body.collides(playerCG,birdPlayerCollide,game),game.bird.body.collides(flyCG),game.bird.kill(),game.frogH=game.add.sprite(10,GAME_HEIGHT-125,"frogHead"),frogH_anim=game.frogH.animations.add("chomp",[0,1,2,3],6,!1),frogH_anim.killOnComplete=!0,frogH_anim.onComplete.add(function(){askQuestion()},game),game.frogH.kill(),1==isTablet?(game.input.onDown.add(tbMove,game),game.input.onUp.add(tbStop,game)):(cursors=game.input.keyboard.createCursorKeys(),game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL),game.time.events.loop(Phaser.Timer.SECOND,secondTimer,game)},update:function(){flyFly(),0==isTablet?(cursors.left.isDown?(game.player.animations.play("left"),game.player.body.velocity.x=-150):cursors.right.isDown&&(game.player.animations.play("right"),game.player.body.velocity.x=150),cursors.up.isDown?(game.player.animations.play(cursors.left.isDown?"left":cursors.right.isDown?"right":"up"),game.player.body.velocity.y=-300):cursors.down.isDown&&(game.player.body.velocity.y=300),0==cursors.left.isDown&&0==cursors.right.isDown&&0==cursors.up.isDown&&0==cursors.down.isDown&&(game.player.animations.stop(),game.player.frame=4)):(1==left?(game.player.animations.play("left"),game.player.body.velocity.x=-150):1==right&&(game.player.animations.play("right"),game.player.body.velocity.x=150),1==up?(game.player.animations.play("up"),game.player.body.velocity.y=-300):1==down&&(game.player.body.velocity.y=300),0==left&&0==right&&0==up&&0==down&&(game.player.animations.stop(),game.player.frame=4))},addBranch:function(e,a,o){var i=game.branches.create(e,a,"ground");return 1!==o&&i.scale.set(-1),game.physics.p2.enable(i),i.body["static"]=!0,i.body.setMaterial(groundMaterial),i.body.clearShapes(),1==o?i.body.loadPolygon("branchPh","branch"):i.body.loadPolygon("branchPh2","branch"),i.body.setCollisionGroup(groundCG),i.body.collides(playerCG),i}},game=new Phaser.Game(GAME_WIDTH,GAME_HEIGHT,Phaser.AUTO,"sign");game.state.add("boot",BootState,!0),game.state.add("preload",PreloadState,!1),game.state.add("level0",Level0,!1),$.cachedScript(jsDesktopProductURL+"settings_page_game.js"),$("#pause").on("click",function(){0==pauseDisabled&&pauseGame(0==game.paused?!0:!1)});